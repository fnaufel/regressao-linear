
{{< include _math.qmd >}}

```{r echo=FALSE, message=FALSE}
source('_setup.R')
set.seed(1234)
#library(patchwork)
#library(gglm)
```


# Regressão linear múltipla

## Simulação

### Multicolinearidade

Vamos criar três preditores `x1`, `x2` e `x3`, com os dois primeiros correlacionados:

```{r}
n <- 100
a <- 2
x1 <- runif(n)
x2 <- a * x1 + rnorm(n, 0, .1)

df <- tibble(x1, x2)
cor(x1, x2)
```



A variável de resposta é `y`:

```{r}
b0 <- 1
b1 <- 2
b2 <- 3
var_epsilon <- .5

y <- b0 + b1 * x1 + b2 * x2 + rnorm(n, sd = sqrt(var_epsilon))
df_y <- df %>% 
  mutate(y = y)
```

Usando todas as variáveis, temos:

```{r}
modelo_12 <- lm(y ~ ., data = df_y)
```

A equação verdadeira é

$$
y = `r b0` + `r b1` x_1 + `r b2` x_2 + \varepsilon
$$

O modelo deu os coeficientes

```{r}
modelo_12 %>% summary()
modelo_12
```

Agora, usando apenas `x1`:

```{r}
modelo_1 <- lm(y ~ x1, data = df_y)
```

A equação verdadeira é --- substituindo $x_2$ por $(b_1 + ab_2)x_1$ ---

$$
y = `r b0` + `r b1 + a * b2` x_1 + \varepsilon
$$

O modelo deu os coeficientes

```{r}
modelo_1 %>% summary()
modelo_1
```

Em termos do $R^2$ ajustado:

* O modelo com os dois preditores teve $R^2_{\text{adj}} = `r modelo_12 %>% glance() %>% pull(adj.r.squared) %>% fm(4)`$.
* O modelo com um preditor teve $R^2_{\text{adj}} = `r modelo_1 %>% glance() %>% pull(adj.r.squared) %>% fm(4)`$.

Para a equação verdadeira:

```{r}
y_eq <- b0 + b1 * x1 + b2 * x2
rsq_vec(y, y_eq)
```

Anova diz que os modelos são diferentes:

```{r}
anova(modelo_12, modelo_1)
```

```{r}
modelo_12 %>% glance()
```

```{r}
modelo_1 %>% glance()
```
